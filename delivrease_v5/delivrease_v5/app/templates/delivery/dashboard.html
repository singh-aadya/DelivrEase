{% extends "base.html" %}
{% block content %}
<h1 class="text-2xl font-extrabold mb-4">Agent Dashboard</h1>

<div class="flex gap-2 mb-4">
  <a class="px-3 py-2 rounded-lg bg-white/10 border border-white/10" href="{{ url_for('delivery.leave') }}">Request Leave</a>
  <a class="px-3 py-2 rounded-lg bg-cyan-400 text-slate-900" href="{{ url_for('delivery.history') }}">History</a>
  
</div>

<p class="mb-2">Your fatigue: <b>{{ fatigue }}</b></p>
{% if pending_count > 0 %}
  <p class="text-amber-300 mb-4">You have {{ pending_count }} pending leave request(s).</p>
{% endif %}

<!-- Orders Table -->
<h2 class="font-bold mb-2 text-lg">Your Assigned Orders</h2>
<div class="overflow-x-auto rounded-xl border border-white/10 mb-8">
  <table class="min-w-full">
    <thead class="bg-white/10"><tr><th class="p-3">Order</th><th class="p-3">From</th><th class="p-3">To</th><th class="p-3">Distance</th><th class="p-3">Status</th><th class="p-3">Action</th></tr></thead>
    <tbody>
    {% for o in orders %}
      <tr class="border-b border-white/10">
        <td class="p-3">{{ o.title }}</td>
        <td class="p-3">{{ o.pickup }}</td>
        <td class="p-3">{{ o.dropoff }}</td>
        <td class="p-3">{{ '%.1f'|format(o.distance_km) }} km</td>
        <td class="p-3">{{ o.status }}</td>
        <td class="p-3">
          {% if o.status != 'delivered' %}
          <form method="post" action="{{ url_for('delivery.mark_delivered', order_id=o.id) }}">
            <button class="px-3 py-1 rounded-lg bg-emerald-400 text-slate-900">Mark Delivered</button>
          </form>
          {% endif %}
        </td>
      </tr>
    {% endfor %}
    </tbody>
  </table>
</div>

<!-- Leave History Table -->
<h2 class="font-bold mb-2 text-lg">Leave History</h2>
<div class="overflow-x-auto rounded-xl border border-white/10">
  <table class="min-w-full">
    <thead class="bg-white/10">
      <tr>
        <th class="p-3">From</th>
        <th class="p-3">To</th>
        <th class="p-3">Reason</th>
        <th class="p-3">Status</th>
        <th class="p-3">Requested On</th>
      </tr>
    </thead>
    <tbody>
      {% for r in leaves %}
        <tr class="border-b border-white/10">
          <td class="p-3">{{ r.date_from }}</td>
          <td class="p-3">{{ r.date_to }}</td>
          <td class="p-3">{{ r.reason or 'â€”' }}</td>
          <td class="p-3">
            <span class="px-2 py-1 rounded-lg text-xs 
              {% if r.status=='approved' %} bg-emerald-500/20 text-emerald-300 border border-emerald-400/30
              {% elif r.status=='declined' %} bg-rose-500/20 text-rose-300 border border-rose-400/30
              {% else %} bg-amber-500/20 text-amber-300 border border-amber-400/30 {% endif %}">
              {{ r.status }}
            </span>
          </td>
          <td class="p-3">{{ r.created_at.date() }}</td>
        </tr>
      {% else %}
        <tr><td colspan="5" class="p-3 text-center text-slate-400">No leave requests yet.</td></tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}
